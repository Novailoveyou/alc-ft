generator client {
  provider = "prisma-client-js"
}

generator custom_generator {
  provider = "prisma-generator-fake-data"
}

generator zod {
  provider = "zod-prisma"
  output   = "./zod" // (default) the directory where generated zod schemas will be saved

  relationModel = true // (default) Create and export both plain and related models.
  // relationModel         = "default" // Do not export model without relations.
  // relationModel         = false // Do not generate related model

  modelCase = "PascalCase" // (default) Output models using pascal case (ex. UserModel, PostModel)
  // modelCase             = "camelCase" // Output models using camel case (ex. userModel, postModel)

  modelSuffix = "Model" // (default) Suffix to apply to your prisma models when naming Zod schemas

  // useDecimalJs          = false // (default) represent the prisma Decimal type using as a JS number
  useDecimalJs = true // represent the prisma Decimal type using Decimal.js (as Prisma does)

  // imports = null // (default) will import the referenced file in generated schemas to be used via imports.someExportedVariable

  // https://www.prisma.io/docs/concepts/components/prisma-client/working-with-fields/working-with-json-fields#filtering-by-null-values
  prismaJsonNullability = true // (default) uses prisma's scheme for JSON field nullability
  // prismaJsonNullability = false // allows null assignment to optional JSON fields
}

datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_PRISMA_URL") // uses connection pooling
}

enum Locale {
  ru
  en
  kk
  be
}

enum PageName {
  home
  catalog
  manufacturer
  product
  cart
  articles
  article
  about
  usage
  docs
  contact
  lead
}

model Image {
  /// The unique identifier for the lead
  /// @default {Generated by database}
  id String @id @default(cuid())

  /// link to the image
  /// @zod.trim().min(3).max(3000)
  src String @default("")

  /// alternative text for the image
  /// @zod.trim().min(2).max(5000).optional()
  alt String? @default("")

  /// user locale
  locale Locale @default(ru)

  /// whether image is published
  isPublished Boolean @default(false)

  /// slides with this image
  slides Slide[]

  /// catalogCards with this image
  catalogCards CatalogCard[]

  @@map(name: "images")
}

model Button {
  /// The unique identifier for the lead
  /// @default {Generated by database}
  id String @id @default(cuid())

  /// button text
  /// @zod.trim().min(1).max(80)
  text String @default("")

  /// button locale
  locale Locale @default(ru)

  /// whether button is published
  isPublished Boolean @default(false)

  /// catalogCards with this button
  catalogCards CatalogCard[]

  /// slides with this button
  slides Slide[]

  /// forms with this button
  forms Form[]

  /// headers with this button
  headers Header[]

  /// footers with this button
  footers Footer[]

  @@map(name: "buttons")
}

model Slide {
  /// The unique identifier for the lead
  /// @default {Generated by database}
  id String @id @default(cuid())

  /// slide locale
  locale Locale @default(ru)

  /// whether Slide is published
  isPublished Boolean @default(false)

  /// slide title
  /// @zod.trim().min(3).max(3000)
  title String @default("")

  /// slide subtitle
  /// @zod.trim().min(3).max(3000).optional()
  subtitle String? @default("")

  /// Whether the slide has cornered rectangle positioned just right of the image
  isDecoration Boolean @default(true)

  /// Slide button
  buttons Button[]

  /// Slide image
  image   Image  @relation(fields: [imageId], references: [id])
  imageId String

  /// SectionGallery with this slide
  sectionGallery   SectionGallery? @relation(fields: [sectionGalleryId], references: [id])
  sectionGalleryId String?

  @@map(name: "slides")
}

model CatalogCard {
  /// The unique identifier for the product
  /// @default {Generated by database}
  id String @id @default(cuid())

  /// card locale
  locale Locale @default(ru)

  /// whether CatalogCard is published
  isPublished Boolean @default(false)

  /// card name
  /// @zod.trim().min(1).max(100)
  name String @default("")

  /// card description
  /// @zod.trim().min(3).max(320)
  description String @default("")

  /// button with this card
  button   Button @relation(fields: [buttonId], references: [id])
  buttonId String

  /// Image with this card
  image   Image  @relation(fields: [imageId], references: [id])
  imageId String

  /// SectionCatalog with this card
  sectionCatalog   SectionCatalog? @relation(fields: [sectionCatalogId], references: [id])
  sectionCatalogId String?

  @@map(name: "catalogCards")
}

model Form {
  /// The unique identifier for the form
  /// @default {Generated by database}
  id String @id @default(cuid())

  /// form locale
  locale Locale @default(ru)

  /// whether form is published
  isPublished Boolean @default(false)

  /// form title
  /// @zod.trim().min(3).max(60)
  title String @default("")

  /// form description
  /// @zod.trim().min(3).max(120)
  description String @default("")

  /// is user name input field displayed on the form
  isName Boolean? @default(false)

  /// is user phone number input field displayed on the form
  isPhoneNumber Boolean @default(true)

  /// is email input field displayed on the form
  isEmail Boolean? @default(false)

  /// is user agreement input field displayed on the form
  isAgreement Boolean @default(true)

  /// form button
  button   Button @relation(fields: [buttonId], references: [id])
  buttonId String

  /// footers with this form
  footers Footer[]

  @@map(name: "forms")
}

model SectionGallery {
  /// The unique identifier for the lead
  /// @default {Generated by database}
  id String @id @default(cuid())

  /// section locale
  locale Locale @default(ru)

  /// whether SectionGallery is published
  isPublished Boolean @default(false)

  /// section index
  index Int @default(0)

  /// an element with border above the heading
  /// @zod.trim().min(1).max(80)
  strap String @default("")

  /// gallery slides 
  slides Slide[]

  /// pages with this section
  pages Page[]

  @@map(name: "sectionGalleries")
}

model SectionCatalog {
  /// The unique identifier for the lead
  /// @default {Generated by database}
  id String @id @default(cuid())

  /// section locale
  locale Locale @default(ru)

  /// whether SectionCatalog is published
  isPublished Boolean @default(false)

  /// section index
  index Int @default(0)

  /// section title
  /// @zod.trim().min(1).max(60)
  title String @default("")

  /// sections cards
  cards CatalogCard[]

  /// pages with this section
  pages Page[]

  @@map(name: "sectionCatalogs")
}

model Header {
  /// The unique identifier for the lead
  /// @default {Generated by database}
  id String @id @default(cuid())

  /// header locale
  locale Locale @default(ru)

  /// whether header is published
  isPublished Boolean @default(false)

  /// header buttons
  buttons Button[]

  /// pages with this header
  pages Page[]

  @@map(name: "headers")
}

model Footer {
  /// The unique identifier for the lead
  /// @default {Generated by database}
  id String @id @default(cuid())

  /// footer locale
  locale Locale @default(ru)

  /// whether footer is published
  isPublished Boolean @default(false)

  /// footer form
  form   Form?   @relation(fields: [formId], references: [id])
  formId String?

  /// footer buttons
  buttons Button[]

  /// pages with this footer
  pages Page[]

  @@map(name: "footers")
}

model Page {
  /// The unique identifier for the lead
  /// @default {Generated by database}
  id String @id @default(cuid())

  /// page name
  name PageName @unique

  /// home page locale
  locale Locale @default(ru)

  /// whether page is published
  isPublished Boolean @default(false)

  /// home page header
  header   Header? @relation(fields: [headerId], references: [id])
  headerId String?

  /// home page gallery
  sectionGallery   SectionGallery? @relation(fields: [sectionGalleryId], references: [id])
  sectionGalleryId String?

  /// home page catalog
  sectionCatalog   SectionCatalog? @relation(fields: [sectionCatalogId], references: [id])
  sectionCatalogId String?

  /// home page footer
  footer   Footer? @relation(fields: [footerId], references: [id])
  footerId String?

  @@map(name: "pages")
}

model Post {
  /// The unique identifier for the post
  /// @default {Generated by database}
  id        String  @id @default(cuid())
  published Boolean @default(false)
  locale    Locale  @default(ru)
  author    User?   @relation(fields: [authorId], references: [id])
  authorId  String?

  @@map(name: "posts")
}

model Lead {
  /// The unique identifier for the lead
  /// @default {Generated by database}
  id String @id @default(cuid())

  /// User who submitted the lead
  user   User   @relation(fields: [userId], references: [id])
  userId String

  /// user url from which the request came
  /// @zod.trim().min(1).max(10000)
  url String @default("")

  /// form name on the page from which the lead came
  /// @zod.trim().min(1).max(100)
  formName String @default("")

  /// user ip
  /// @zod.trim().min(1).max(39)
  ip String @default("")

  /// Google analitics client ID
  /// @zod.trim().min(1).max(100).optional()
  gmClientId String?

  /// Yandex metrics ID
  /// @zod.trim().min(1).max(100).optional()
  ymClientID String?

  /// user agent
  /// @zod.trim().min(1).max(100)
  userAgent String @default("")

  /// user utm_source url param
  /// @zod.trim().min(1).max(400).optional()
  utm_source String? @default("")

  /// user utm_medium url param
  /// @zod.trim().min(1).max(400).optional()
  utm_medium String? @default("")

  /// user utm_campaign url param
  /// @zod.trim().min(1).max(400).optional()
  utm_campaign String? @default("")

  /// user utm_content url param
  /// @zod.trim().min(1).max(400).optional()
  utm_content String? @default("")

  /// user utm_term url param
  /// @zod.trim().min(1).max(400).optional()
  utm_term String? @default("")

  /// createdAt user date at the request time
  /// @zod.custom(z.coerce.date())
  createdAt DateTime @default(now()) @map(name: "created_at")

  /// lead locale
  locale Locale @default(ru)

  @@map(name: "leads")
}

model User {
  /// The unique identifier for the user
  /// @default {Generated by database}
  id String @id @default(cuid())

  /// user name
  /// @zod.trim().min(2).max(100).optional()
  name String?

  /// user phone number
  /// @zod.trim().startsWith('+').regex(/^(\+\d{1,2}\s?)?\(?\d{3}\)?[\s.-]?\d{3}[\s.-]?\d{4}$/).min(5).max(30)
  phoneNumber String @unique @default("")

  /// user email
  /// @zod.trim().email().min(5).max(100).optional()
  email String? @unique

  /// user personal data usage agreement
  /// @zod.custom(z.literal(true))
  isDataUsageAgreement Boolean @default(false)

  /// user company
  /// @zod.trim().min(5).max(200).optional()
  company String?

  /// createdAt user date at the request time
  /// @zod.custom(z.coerce.date())
  createdAt DateTime @default(now()) @map(name: "created_at")

  /// updatedAt user date at the request time 
  /// @zod.custom(z.coerce.date())
  updatedAt DateTime @updatedAt @map(name: "updated_at")

  /// user locale
  locale Locale @default(ru)

  leads Lead[]
  Post  Post[]

  @@map(name: "users")
}
